---
layout: post
image: /assets/img/vue/vuejs.jpg
# accent_image:
#   background: url('/assets/img/javascript.png') center/cover
#   overlay: false
accent_color: '#ccc'
theme_color: '#ccc'
description: >
  웹 APP의 Unit Test에 대해 알아보도록 하겠습니다.
invert_sidebar: false
categories:
  - frontend
  - vue
  - vue-clone
  - test
---

# Unit Test

안녕하세요. 성장하는 것을 즐기는 `changuk`이라고 합니다. 현재 `fastcampus`에서 `frontend` 개발을 공부하고 있습니다. 강의를 들으면서 해온 것들을 작성하여 지식을 공유하고 또 제가 잊었을 때 다시 와서 볼 수 있도록 내용들을 정리하려고 합니다.

1. toc
{:toc .large-only}

---

이번시간에는 웹 App을 **Test**하는 방법에 대해 알아보겠습니다.

---

## Unit Test
- **단위(Unit) 테스트**란 데이터(상태), 함수(메서드), 컴포넌트 등의 정의된 프로그램 최소 단위들이 독립적으로 정상 동작하는지 확인하는 방법입니다. 여기서 중요한 개념은 **단위(Unit)**라는 개념입니다.

  - 코드위주로 테스트를 하고,**(테스트 코드)** 테스트를 통과하면 신뢰성을 확보할 수 있습니다.
  - 테스트에 기반해서 **안정적인 수정**이 가능합니다.
  - 가볍고 빠르고 단순하게 테스트를 진행할 수 있습니다.


## E2E Test
- **E2E(End to End) 테스트**는 단위 테스트와는 반대로 실제로 우리가 만든 웹사이트를 **직접 사용하면서 테스트**하는 방법입니다.
- 애플리케이션의 처음부터 끝까지의 실제 사용자의 관점에서 사용 흐름을 테스트하는 방법이라고 할 수 있습니다.


## 테스트 라이브러리 소개
<img src="/assets/img/vue/test/vuejs-unit-e2e.png" width="500" height="400"  >

- **단위(Unit) 테스트** : **VueJS**의 컴포넌트 단위로 테스트를 진행하기 위해, **VueJS**에서 제공하는 **Vue Test Utils**를 **Jest**에 연결해서 사용할 수 있습니다.

- **E2E 테스트** : **Cypress.io**라는 테스트 도구를 사용하여 **E2E테스트**틀 사용할 수 있습니다.

그럼 패키지를 설치해주도록 하겠습니다.

> `npm i -D jest @vue/test-utils@next vue-jest@next babel-jest`

### jest.config.js
프로젝트 작업 경로에 해당 파일을 만들어주고, 내용을 다음과 같이 기입하도록 하겠습니다.

```js
module.exports = {
  moduleFileExtensions: [
    'js',
    'vue'
  ],
  moduleNameMapper: {
    '^~/(.*)$': '<rootDir>/src/$1'
  },
  modulePathIgnorePatterns: [
    '<rootDir>/node_modules',
    '<rootDir>/dist'
  ],
  testURL: 'http://localhost',
  transform: {
    '^.+\\.vue$': 'vue-jest',
    '^.+\\.js$': 'babel-jest'
  }
}
```
#### moduleFileExtension
  - 파일 확장자를 지정하지 않은 경우, **Jest**가 검색하게 되는 확장자의 목록입니다.
  - 일반적으로 많이 사용되는 모듈의 확장자를 지정합니다.
  - 다음과 같이 사용할 수 있습니다. 
    - `import HelloWorld from '~/components/HelloWorld';`

#### moduleNameMapper
  - `~` 같은 경로 별칭을 매핑합니다.
  - `<rootDir>` 토큰을 사용해 루트 경로를 참조할 수 있습니다.
    - 다음과 같이 사용할 수 있습니다.
      - `import HelloWorld from '~/components/HelloWorld';`

  -  `<rootDir>/src/`에 있는 `$1`으로 통칭되는 모든 경로들을 위의 정규식과 매핑해서 사용하겠다는 의미입니다.
     - `.`: 임의의 하나의 문자
     - `*`: 최대한 많이 일치하도록 하는 정규식
     - `$1`: 모든 경로를 의미

#### moduleIPathIgnorePatterns
- 일치하는 경로에서 모듈을 가져오지 않습니다.
- `<rootDir>`토큰을 사용해 루트 경로를 참조할 수 있습니다.

#### testURL
- **jsdom** 환경에(HTML과 유사) 대한 **URL**을 설정합니다.
- https://github.com/facebook/jest/issues/6766

#### transform
- 정규식과 일치하는 파일의 변환 모듈을 지정합니다.
- **jest**는 **VueJS**만을 테스트하기 위해 만들어진것이 아니기 때문에 우리의
- 프로젝트 환경에 맞게 세팅해주면 됩니다.
- **.vue**로 끝나는 파일들은 **vue-jest**라는 패키지를 사용해서 변환해주면 되는 것이고
- **.js**로 끝나는 파일들은 **bable-jest**라는 패키지를 사용해서 변환해주면 되는 것입니다.


### tests/example.test.js
프로젝트 작업 경로에 **test** 폴더를 생성해주고, 내부에 **example.test.js** 파일을 생성해주었습니다. 다만, 지금은 무얼 작성해도 컴파일 에러가 나타납니다. 이유는 **eslint**에서 **jest**를 인식하지 못해서 그런 것이므로, **.eslintrc.js** 파일을 수정하여 **jest**를 인식시키도록 하겠습니다.

#### .eslintrc.js
```js
module.exports = {
  env: {
    browser: true,
    node: true,
    jest: true,
  },
  ...
}
```

## First Test
우리의 첫 테스트를 수행해보겠습니다. **tests**폴더안에 **example.js**파일을 생성하고 다음과 같이 작성하였습니다. 그리고 만든 함수를 **test** 환경에서 동작시키기 위해 **export** 키워드로 **double**함수를 내보냈습니다.

```js
export function double(num) {
  return num * 2
}
```
여담으로 **js**나 **vue**파일을 다른 파일에서 사용하길 원한다면 **export**로 내보내주어야 한다는 것을 기억해주시면 되겠습니다. <br>

이제 테스트를 수행해봅시다. **example.text.js** 파일을 다음과 같이 작성해주고 터미널에서 스크립트를 동작시키도록 하겠습니다. 

```js
import { double } from './example'

test('첫 테스트', () => {
  expect(123).toBe(123)
})
```

스크립트를 동작시키기 편하도록 package.json을 조금 수정하겠습니다. `"test:unit": "jest --watchAll"`의 **--watchAll**에 대해 해석을 하자면, 모든 테스트 파일의 변경사항을 감시해서 변경사항이 발생하게 되면 **테스트 환경을 다시 동작**시키는 플래그입니다. 아래와 같이 작성하면, 이제 콘솔 창에서 `npm run test:unit`을 동작시키면 **example.test.js**에 작성한 내용을 **테스트** 하게 될 것입니다.

```json
{
  ...,
    "scripts": {
    "dev:webpack": "webpack-dev-server --mode development",
    "dev": "netlify dev",
    "build": "webpack --mode production",
    "lint": "eslint --fix --ext .js,.vue",
    "test:unit": "jest --watchAll"
  },
  ...
}
```

파일의 내용을 다음과 같이 바꾸면, **test**가 실패했다는 결과가 출력됩니다. 즉, **Expected** 값과 **Received**의 값이 다르기 때문에 발생하는 문제입니다.
```js
import { double } from './example'

test('첫 테스트', () => {
  expect(123).toBe('123')
})
```

다음과 같이 작성하게 되면 어떻게 될까요? 아래의 `test()`함수에 작성한 내용도 테스트 결과 실패했다는 결론이 나게 됩니다. `expect()` 함수에서 반환하는 값이 `toBe()` 함수에 입력된 인수와 다르기 때문이지요.

```js
import { double } from './example'

test('첫 테스트', () => {
  expect(123).toBe('123')
})

test('인수가 숫자 데이터입니다.', () => {
  expect(double(3)).toBe(7)
})
```
만약 `double()` 함수에 입력값이 없으면 어떤 결과가 출력되는 것이 맞을까요? 현재는 **NaN**이 출력되는데 아무래도 숫자가 아닌 결과가 출력되는게 좀 이상하게 보이네요. 그러니 **if**문을 추가해서 **NaN**이 아니라 숫자 0이 출력되도록 함수를 다음과 같이 바꾸었습니다.

```js
export function double(num) {
  if (!num) {
    return 0
  }
  return num * 2
}
```

이와 같이, 특정 파일이 가지고 있는 로직들을 테스트 환경으로 가지고 와서 그것이 정상적으로 동작하는지에 대한 테스트 코드를 작성하고 테스트 환경을 실행해서 모든 테스트가 정상적으로 동작하는지를 확인해볼 수 있는 구조입니다.

## Jest Globals
이번에는 **Jest**에서 제공하는 여러가지 전역함수에 대해 알아보겠습니다.
<a href="https://jestjs.io/docs/api" target="_blank">**Jest Globals**</a>이 링크에서 여러 함수들을 확인할 수 있습니다.

### test() 함수
앞서 우리가 살펴보았던 함수입니다. 
- 첫 번째 인수로 **테스트의 이름**을 명시해주면 되고 
- 두 번째 인수로는 **Callback** 함수를 작성해서 함수 내부에서 테스트를 진행해주면 됩니다.


### describe() 함수
이전에 `test()` 함수에 작성했던 내용을 `describe()` 함수 내부에 작성해주겠습니다. 이 함수는 `test()`들을 묶어내는 용도로 사용해줄 수 있기 때문에, 일종의 **test** 그룹이라고 생각할 수 있겠습니다. 그리고 그룹을 짓는 이유는 **before**, **after**라는 전역함수를 사용하기 위함입니다.

- `beforeAll()`
  - 그룹 안의 모든 **test**가 시작하기 전에 단 한번만 실행됩니다.
- `afterAll()`
  - 그룹 안의 모든 **test**가 시작하고 난 다음에 명시된 내용을 단 한번 실행할 수 있습니다.
- `beforeEach()`
  - 각각의 **test**가 시작하기 전에 한번씩 실행되는 구조입니다.
- `afterEach()`
  - 각각의 **test**가 시작한 이후에 한번씩 실행되는 구조입니다.

코드를 다음과 같이 작성하고 각 함수들이 어디서 실행되는지를 파악해봅시다.

```js
import { double } from './example'

describe('그룹1', () => {
  beforeAll(() => {
    console.log('beforeAll!')
  })
  afterAll(() => {
    console.log('afterAll!')
  })
  beforeEach(() => {
    console.log('beforeEach!')
  })
  afterEach(() => {
    console.log('afterAll!')
  })
  test('첫 테스트', () => {
    console.log('첫 테스트!')
    expect(123).toBe(123)
  })
  
  test('인수가 숫자 데이터입니다.', () => {
    console.log('인수가 숫자 데이터입니다.')
    expect(double(3)).toBe(6)
    expect(double(10)).toBe(20)
  })
  
  test('인수가 없습니다.', () => {
    console.log('인수가 없습니다.')
    expect(double()).toBe(0)
  })
})
```

## Jest Matchers